name: "Continuous Integration"

on:
  push:
    branches:
      - "main"
    tags:
      - "*"
  pull_request:
    branches:
      - "main"

jobs:
  testing:
    name: "Testing"
    runs-on: "ubuntu-latest"
    strategy:
      matrix:
        php: ['8.2', '8.3']
    steps:
      - uses: actions/checkout@v4
      - uses: shivammathur/setup-php@v2
        with:
          php-version: ${{ matrix.php }}
          coverage: none
      - run: "composer install --no-interaction"
      - run: "vendor/bin/php-cs-fixer fix --dry-run -v"
  report:
    name: "Report"
    needs: testing
    runs-on: "ubuntu-latest"
    steps:
      - uses: actions/checkout@v4
      - uses: shivammathur/setup-php@v2
        with:
          php-version: '8.4'
          coverage: xdebug
      - run: "composer install --no-interaction"
      - run: "XDEBUG_MODE=coverage vendor/bin/phpunit"
      - uses: codacy/codacy-coverage-reporter-action@v1.3.0
        with:
          project-token: ${{ secrets.CODACY_PROJECT_TOKEN }}
          coverage-reports: clover.xml
